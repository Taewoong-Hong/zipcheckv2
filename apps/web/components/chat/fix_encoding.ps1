# Read file with UTF-8 encoding
$content = Get-Content -Path ChatInterface.tsx -Raw -Encoding UTF8

# Fix common Korean encoding issues
$fixes = @{
    '???�션' = '세션'
    '??중복 ?�출 방�?' = '중복 호출 방지'
    '??�태 추�?' = '상태 추가'
    '??채팅 ?�면?�서' = '채팅 화면에서'
    '??�전 ?�??' = '이전 대화'
    '??�동 복구' = '자동 복구'
    '??(?�전 ?�?�의 ?�태가 ?�아 주소 ?�계�?건너?�는 ?�슈 방�?)' = '(이전 세션의 상태가 없어 주소 단계를 건너뛰는 이슈 방지)'
    '??Race condition 방�?' = 'Race condition 방지'
    '??ref 추�?' = 'ref 추가'
    '??prop??직접 ?�용' = 'prop을 직접 사용'
    '??(getSession() ?�출 ?�거)' = '(getSession() 호출 제거)'
    '???�달받�? session 직접 ?�용' = '전달받은 session 직접 사용'
    '??(?�?�밍 ?�슈 ?�결)' = '(타이밍 이슈 해결)'
    '??New conversation created' = 'New conversation created'
    '???�존??보강' = '의존성 보강'
    '최신 ?�큰 ?�보' = '최신 토큰 정보'
    '??(?�션 prop???�래?�었?????�음)' = '(세션 prop이 전달되었을 수 있음)'
    '?�택??주소' = '선택한 주소'
    '케?�스 ?�성 �?' = '케이스 생성 중'
    '?�류가 발생?�습?�다' = '오류가 발생했습니다'
    '?�시 ?�도?�주?�요' = '다시 시도해주세요'
    '계약 ?�형' = '계약 유형'
    '매매가' = '매매가'
    '보증�?' = '보증금'
    '?�세' = '월세'
    '?�기부?�본' = '등기부등본'
    '발급 ?�청' = '발급 신청'
    '?�로�?' = '업로드'
    '?�직 구현?��? ?�았?�니??' = '아직 구현되지 않았습니다'
    'PDF ?�일???�로?�해주세??' = 'PDF 파일을 업로드해주세요'
    '?�기부 처리 �?' = '등기부 처리 중'
    'PDF�??�시 ?�로?�해 주세??' = 'PDF를 다시 업로드해 주세요'
    '분석 �?' = '분석 중'
    '??prop?�로 받�? session ?�용' = 'prop으로 받은 session 사용'
    '로그???�션??만료?�었?�니??' = '로그인 세션이 만료되었습니다'
    '?�이지�??�로고침?�주?�요' = '페이지를 새로고침해주세요'
    '???�전 ?�청 중단' = '이전 요청 중단'
    '??메시지 ?�력 ??' = '새 메시지 입력 시'
    '???�출 �??�태 ?�정' = '제출 중 상태 설정'
    '??(500ms ?�안 추�? ?�출 차단)' = '(500ms 동안 추가 호출 차단)'
    '??chatStorage???�션 복원?�으로만 ?�용' = 'chatStorage는 세션 복원용으로만 사용'
    '??(?�시�??�기???�거)' = '(임시적 저장은 제거)'
    '???�용??메시지가 추�??�면' = '사용자 메시지가 추가되면'
    '즉시 "처리 �? 메시지 ?�시' = '즉시 "처리 중" 메시지 표시'
    '메시지�?처리?�고 ?�습?�다' = '메시지를 처리하고 있습니다'
    '주소�?검?�해주세??' = '주소를 검색해주세요'
    '?�확??주소�??�택?�면' = '정확한 주소를 선택하면'
    '분석?????�확?�집?�다' = '분석이 더 정확해집니다'
    '??처리 �?메시지�??�제 AI ?�답?�로 교체' = '처리 중 메시지를 실제 AI 응답으로 교체'
    '처리 �?메시지 ?�거?�고' = '처리 중 메시지 제거하고'
    '?�로??AI 메시지 추�?' = '새로운 AI 메시지 추가'
    '??processing-?�로 ?�작?�는 ID�?가�?메시지 ?�거' = 'processing-으로 시작하는 ID를 가진 메시지 제거'
    '???�답 ?�더?�서 ??conversation_id ?�인' = '응답 헤더에서 새 conversation_id 확인'
    '??Received new conversation ID from server' = 'Received new conversation ID from server'
    '???�스??' = '시스템'
    '기능???�행?�려 ?�으?' = '기능을 실행하려 했으나'
    '죄송?�니??' = '죄송합니다'
    '?�답???�성?�는 �?' = '답변을 생성하는 중'
    '?�시 ?�도??주세??' = '다시 시도해 주세요'
    '??500ms ???�출 가???�태�?변�?' = '500ms 후 호출 가능 상태로 변경'
    '??(?�바?�싱)' = '(디바운싱)'
    '즉시 submit ?�행' = '즉시 submit 실행'
    '???�일 ?�로???�태 추�?' = '파일 업로드 상태 추가'
    '???�일 ?�로??처리 ?�수' = '파일 업로드 처리 함수'
    '비로그인 ?�태' = '비로그인 상태'
    '????로그???�도' = '에서 로그인 유도'
    '?�일 ?�로???�태 메시지 ?�시' = '파일 업로드 상태 메시지 표시'
    '?�일' = '파일'
    '개�? ?�로?�하�??�습?�다' = '개를 업로드하고 있습니다'
    '?�기???�제 ?�일 ?�로??API ?�출' = '여기에 실제 파일 업로드 API 호출'
    '?�제 ?�로???�드?�인??구현 ?�요' = '실제 업로드 엔드포인트 구현 필요'
    '?�로???�료 ???�일 목록 ?�데?�트' = '업로드 완료 후 파일 목록 업데이트'
    '?�로???�료 메시지�?교체' = '업로드 완료 메시지로 교체'
    '???�일' = '파일'
    '개�? ?�로?�되?�습?�다' = '개가 업로드되었습니다'
    '?�일 ?�보�?채팅 컨텍?�트??추�?' = '파일 정보를 채팅 컨텍스트에 추가'
    '?�로?�된 ?�일' = '업로드된 파일'
    '?�일 ?�로???�패' = '파일 업로드 실패'
    '?�러 메시지�?교체' = '에러 메시지로 교체'
    '???�일 ?�로?�에 ?�패?�습?�다' = '파일 업로드에 실패했습니다'
    '???�래�????�롭 ?�태 추�?' = '드래그앤드롭 상태 추가'
    '???�래�????�롭 ?�벤???�들??' = '드래그앤드롭 이벤트 핸들러'
    '?�일 ?�래그�? ?�닌 ?�스???�래�??�택 ?�에??반응?��? ?�도�?가??' = '파일 드래그가 아닌 텍스트 드래그 선택 시에는 반응하지 않도록 가드'
    'PDF �?문서 ?�일�??�터�?' = 'PDF 및 문서 파일만 필터링'
    '지?�되지 ?�는 ?�일 ?�식?�니??' = '지원되지 않는 파일 형식입니다'
    '?�일�??�로??가?�합?�다' = '파일을 업로드 가능합니다'
    '???�래�????�롭 ?�버?�이' = '드래그앤드롭 오버레이'
    '?�일???�기???�으?�요' = '파일을 놓기만 하면되요'
    '?�일 지??' = '파일 지원'
    '주소�??�력?�시�?' = '주소를 입력하시면'
    '부?�산 계약??분석?�드릴게??' = '부동산 계약을 분석해드릴게요'
    '부?�산 계약�?관?�된 무엇?�든 물어보세??' = '부동산 계약에 관련된 무엇이든 물어보세요'
    '???�치' = '딥서치'
    '?�일 ?�로??' = '파일 업로드'
    '?�� ?��?�?계약 분석 가?�드' = '전월세 계약 분석 가이드'
    '?�약?�항�?보증�?보호 조건???�인?�드?�요' = '특약사항과 보증금 보호 조건을 확인해드려요'
    '?�� 매매 계약 검??가?�드' = '주택 매매 계약 검토 가이드'
    '최적??매매가?� ?�상 ?��??? ?�약?�항??검?�해?�려??' = '최적의 매매가와 협상 포인트, 특약사항을 검토해드려요'
    '???�세 계약 체크리스??' = '월세 계약 체크리스트'
    '?�세 계약 ???�수 ?�인?�항???�계별로 ?�내?�드?�요' = '월세 계약 시 필수 확인사항을 단계별로 안내해드려요'
    '?�� ?�세?�기 ?�해 가?�드' = '주택 전세사기 예방 가이드'
    '?�해 ?�?�을 ?�한 ?�계�?가?�드' = '피해 사례를 통한 단계별 가이드'
    '?�식???�공?�드?�요' = '정식으로 제공해드려요'
    'AI ?��? ?�성 �?로딩 ?�디케?�터' = 'AI 답변 생성 중 로딩 인디케이터'
    '메시지�??�력?�세??' = '메시지를 입력하세요'
    '??강제 ?�태 ?�정' = '강제 상태 설정'
    '(중간 ?�계 건너?�기)' = '(중간 단계 건너뛰기)'
    '백엔??gating??registry_choice�?반환?�면' = '백엔드 gating이 registry_choice를 반환하면'
    '즉시 ?�당 ?�태�??�동' = '즉시 해당 상태로 이동'
    '??최근 10�?메시지 ?�스?�리 ?�함' = '최근 10개 메시지 히스토리 포함'
    '??(ChatGPT 방식)' = '(ChatGPT 방식)'
    '???�최근 ?�???�스?�리 ?�함' = '최근 대화 히스토리 포함'
    '?��??�이??�?' = '테스트 시뮬레이션'
}

foreach ($old in $fixes.Keys) {
    $new = $fixes[$old]
    $content = $content -replace [regex]::Escape($old), $new
}

# Save with UTF-8 encoding (without BOM)
$utf8NoBom = New-Object System.Text.UTF8Encoding $false
[System.IO.File]::WriteAllText("ChatInterface.tsx", $content, $utf8NoBom)

Write-Host "Fixed encoding issues in ChatInterface.tsx"
