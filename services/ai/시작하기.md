# 🚀 ZipCheck AI 서비스 시작 가이드

## 📦 P0 완료 — 기본 인프라 구축 완료!

### ✅ 완료된 작업

1. **FastAPI 서버 스캐폴딩**
   - 서버 부팅 및 헬스체크 엔드포인트
   - CORS 미들웨어 설정
   - 환경 변수 기반 설정 시스템

2. **핵심 모듈 구현**
   - LLM 팩토리 (OpenAI/Claude 지원)
   - 임베딩 및 벡터 검색 시스템
   - LangChain LCEL 분석 체인
   - PDF 파싱 및 벡터 업서트

3. **개발 환경 설정**
   - Docker 이미지 준비
   - 환경 변수 템플릿
   - OpenAPI 3.1 스펙

---

## 🎯 바로 시작하기 (5분 설정)

### 1단계: 가상환경 설정

```bash
# services/ai 디렉토리로 이동
cd services/ai

# 가상환경 생성
python -m venv venv

# 가상환경 활성화
# Windows
venv\Scripts\activate
# Mac/Linux
source venv/bin/activate
```

### 2단계: 의존성 설치

```bash
# Python 패키지 설치 (약 2-3분 소요)
pip install -r requirements.txt
```

### 3단계: 환경 변수 설정

`.env` 파일을 열고 다음 필수 값을 입력하세요:

```env
# Supabase PostgreSQL URL
DATABASE_URL=postgresql://postgres.[PROJECT_ID]:[PASSWORD]@[HOST]:5432/postgres

# OpenAI API 키
OPENAI_API_KEY=sk-proj-...

# Anthropic API 키
ANTHROPIC_API_KEY=sk-ant-...
```

> 💡 **팁**: `.env.example` 파일에 모든 가능한 환경 변수가 정의되어 있습니다.

### 4단계: 서버 시작

```bash
# 개발 서버 실행 (자동 재시작 활성화)
uvicorn app:app --reload --port 8000
```

**성공 메시지:**
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     ZipCheck AI 서비스 시작
INFO:     Application startup complete.
```

### 5단계: 테스트

#### 브라우저에서 확인
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

#### 커맨드라인에서 확인
```bash
# 헬스체크
curl http://localhost:8000/healthz

# 예상 응답:
# {"ok":true,"version":"2.0.0","environment":"development"}
```

---

## 🗂️ 프로젝트 구조

```
services/ai/
├─ 📄 app.py                    # FastAPI 메인 애플리케이션
├─ 📁 core/                     # 핵심 비즈니스 로직
│  ├─ settings.py              # 환경 변수 설정
│  ├─ llm_factory.py           # LLM 인스턴스 생성
│  ├─ embeddings.py            # 임베딩 모델
│  ├─ retriever.py             # 벡터 검색
│  ├─ chains.py                # 분석 체인 (LCEL)
│  └─ dual_provider.py         # 폴백 로직
├─ 📁 ingest/                   # PDF 처리
│  ├─ pdf_parse.py             # PDF → 텍스트
│  └─ upsert_vector.py         # 텍스트 → 벡터 DB
├─ 📁 api/                      # API 스펙
│  └─ openapi.yaml             # OpenAPI 3.1
├─ 📄 requirements.txt          # Python 의존성
├─ 🐳 Dockerfile                # 컨테이너 이미지
├─ 📄 .env.example              # 환경 변수 템플릿
└─ 📖 README.md                 # 영문 문서
```

---

## 🔧 주요 엔드포인트

### 1. 헬스체크
```bash
GET /healthz
```
서버 상태 확인

### 2. PDF 업로드 (구현 완료, 테스트 대기)
```bash
POST /ingest
Content-Type: multipart/form-data

{
  file: (binary),
  contract_id: "contract_001",
  addr: "서울시 강남구 테헤란로 123"
}
```

### 3. 계약서 분석 (구현 완료, 테스트 대기)
```bash
POST /analyze
Content-Type: application/json

{
  "question": "계약금 관련 리스크를 분석해주세요",
  "mode": "single",
  "provider": "openai"
}
```

---

## 🧪 다음 단계 테스트

### Supabase 설정이 완료되면:

1. **pgvector 확장 활성화**
```sql
CREATE EXTENSION IF NOT EXISTS vector;
```

2. **샘플 PDF 업로드 테스트**
```bash
curl -X POST http://localhost:8000/ingest \
  -F "file=@sample_contract.pdf" \
  -F "contract_id=test_001" \
  -F "addr=서울시 강남구"
```

3. **분석 요청 테스트**
```bash
curl -X POST http://localhost:8000/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "question": "이 계약서의 주요 리스크는 무엇인가요?",
    "mode": "single"
  }'
```

---

## 🐳 Docker로 실행하기

### 이미지 빌드
```bash
docker build -t zipcheck-ai:latest .
```

### 컨테이너 실행
```bash
docker run -p 8000:8000 \
  --env-file .env \
  zipcheck-ai:latest
```

---

## 📊 현재 구현 상태

| 기능 | 상태 | 비고 |
|------|------|------|
| FastAPI 서버 | ✅ 완료 | 부팅 및 헬스체크 동작 |
| 환경 변수 시스템 | ✅ 완료 | Pydantic Settings |
| OpenAPI 스펙 | ✅ 완료 | `/docs`에서 확인 가능 |
| PDF 파싱 | ✅ 완료 | unstructured + PyMuPDF |
| 벡터 업서트 | ✅ 완료 | LangChain + pgvector |
| 단일 LLM 분석 | ✅ 완료 | OpenAI/Claude 지원 |
| 실제 동작 테스트 | ⏳ 대기 | Supabase 설정 필요 |
| 컨센서스 모드 | ⏳ P3 | 듀얼 LLM + 저지 |
| 비동기 큐 | ⏳ P3 | Celery/RQ |

---

## 🚨 트러블슈팅

### 서버가 시작되지 않아요
- `.env` 파일에 필수 환경 변수가 있는지 확인하세요
  - `DATABASE_URL`
  - `OPENAI_API_KEY`
  - `ANTHROPIC_API_KEY`
- Python 버전을 확인하세요 (3.11+ 권장)

### 의존성 설치가 실패해요
```bash
# pip 업그레이드
pip install --upgrade pip

# 개별 설치 시도
pip install fastapi uvicorn
pip install langchain langchain-openai langchain-anthropic
```

### DATABASE_URL을 모르겠어요
Supabase 프로젝트 설정에서:
1. Settings → Database
2. Connection String → URI 복사
3. `.env`의 `DATABASE_URL`에 붙여넣기

---

## 📚 추가 문서

- [README.md](./README.md) - 영문 기술 문서
- [P0_COMPLETION.md](./P0_COMPLETION.md) - P0 완료 보고서
- [api/openapi.yaml](./api/openapi.yaml) - OpenAPI 스펙

---

## 🎯 다음 마일스톤: P1

**P1 — 데이터/보안 토대 (Day 1~3)**

1. Supabase 스키마 설계
   - `profiles`, `contracts`, `documents`, `embeddings`, `reports` 테이블
   - pgvector 인덱스 (IVFFlat)
   - RLS 정책 설정

2. 파일 스토리지 레이어
   - Supabase Storage 연동
   - 파일 검증 강화

**시작 준비 완료!** 🚀
